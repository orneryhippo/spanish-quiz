<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI-Powered Spanish Translation Quiz</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState } = React;

        const CATEGORIES = [
            'Random',
            'Numbers & Time',
            'Restaurant & Food',
            'Shopping & Commerce',
            'Directions & Navigation',
            'Weather Descriptions',
            'Clothing & Appearance',
            'House & Furniture',
            'Transportation & Travel',
            'Work & Office',
            'Medical & Health',
            'Family & Relationships'
        ];

        // Lucide Icons as React components
        const BookOpen = ({ className }) => (
            <svg className={className} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"></path>
                <path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"></path>
            </svg>
        );

        const RefreshCw = ({ className }) => (
            <svg className={className} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"></path>
                <path d="M21 3v5h-5"></path>
                <path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"></path>
                <path d="M3 21v-5h5"></path>
            </svg>
        );

        const Check = ({ className }) => (
            <svg className={className} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <polyline points="20 6 9 17 4 12"></polyline>
            </svg>
        );

        const X = ({ className }) => (
            <svg className={className} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <line x1="18" y1="6" x2="6" y2="18"></line>
                <line x1="6" y1="6" x2="18" y2="18"></line>
            </svg>
        );

        const Loader2 = ({ className }) => (
            <svg className={className} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="M21 12a9 9 0 1 1-6.219-8.56"></path>
            </svg>
        );

        const ChevronDown = ({ className }) => (
            <svg className={className} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <polyline points="6 9 12 15 18 9"></polyline>
            </svg>
        );

        function SpanishQuizApp() {
            const [currentCategory, setCurrentCategory] = useState('Random');
            const [currentQuestion, setCurrentQuestion] = useState(null);
            const [userAnswer, setUserAnswer] = useState('');
            const [isGenerating, setIsGenerating] = useState(false);
            const [isEvaluating, setIsEvaluating] = useState(false);
            const [feedback, setFeedback] = useState(null);
            const [score, setScore] = useState({ correct: 0, total: 0 });
            const [showAnswer, setShowAnswer] = useState(false);
            const [error, setError] = useState(null);
            const [showCategoryDropdown, setShowCategoryDropdown] = useState(false);

            const getRandomCategory = () => {
                const categories = CATEGORIES.filter(c => c !== 'Random');
                return categories[Math.floor(Math.random() * categories.length)];
            };

            const generateQuestion = async () => {
                setIsGenerating(true);
                setError(null);
                setFeedback(null);
                setShowAnswer(false);
                setUserAnswer('');
                setCurrentQuestion(null);

                const categoryToUse = currentCategory === 'Random' ? getRandomCategory() : currentCategory;

                const prompt = `You are generating Spanish translation quiz questions.

Category: ${categoryToUse}

Generate ONE random, realistic translation question for this category. The question should be something a language learner would encounter in real life.

Respond ONLY with valid JSON:
{
  "englishPrompt": "the English phrase/sentence to translate",
  "context": "brief context if needed (optional)",
  "difficulty": "beginner/intermediate/advanced"
}

Make it varied and realistic. Do not repeat common examples.
DO NOT include the Spanish answer.
Output ONLY the JSON, no markdown or other text.`;

                try {
                    const response = await fetch('https://api.anthropic.com/v1/messages', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            model: 'claude-sonnet-4-20250514',
                            max_tokens: 500,
                            messages: [{ role: 'user', content: prompt }]
                        })
                    });

                    if (!response.ok) {
                        throw new Error('Failed to generate question');
                    }

                    const data = await response.json();
                    let responseText = data.content[0].text;
                    
                    responseText = responseText.replace(/```json\n?/g, '').replace(/```\n?/g, '').trim();
                    
                    const questionData = JSON.parse(responseText);
                    setCurrentQuestion({ ...questionData, category: categoryToUse });
                } catch (err) {
                    setError('Failed to generate question. Please try again.');
                    console.error(err);
                } finally {
                    setIsGenerating(false);
                }
            };

            const evaluateAnswer = async () => {
                if (!userAnswer.trim()) return;

                setIsEvaluating(true);
                setError(null);

                const prompt = `You are evaluating Spanish language quiz answers.

Category: ${currentQuestion.category}
English prompt: "${currentQuestion.englishPrompt}"
Student's Spanish answer: "${userAnswer}"

Evaluate if the student's Spanish translation is correct. Be FLEXIBLE and GENEROUS with:
- Minor spelling mistakes
- Accents (accept with or without)
- Synonym variations
- Different grammatically correct phrasings
- Regional variations
- Formal vs informal register (unless context demands specific register)

Respond ONLY with valid JSON:
{
  "correct": true or false,
  "correctAnswer": "one example of a correct translation",
  "alternativeAnswers": ["other valid translations"],
  "feedback": "encouraging message if correct, or helpful tip if incorrect (one sentence)"
}

Be generous in your evaluation - if it's understandable and mostly correct, mark it correct.
Output ONLY the JSON, no markdown or other text.`;

                try {
                    const response = await fetch('https://api.anthropic.com/v1/messages', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            model: 'claude-sonnet-4-20250514',
                            max_tokens: 500,
                            messages: [{ role: 'user', content: prompt }]
                        })
                    });

                    if (!response.ok) {
                        throw new Error('Failed to evaluate answer');
                    }

                    const data = await response.json();
                    let responseText = data.content[0].text;
                    
                    responseText = responseText.replace(/```json\n?/g, '').replace(/```\n?/g, '').trim();
                    
                    const evaluation = JSON.parse(responseText);
                    setFeedback(evaluation);
                    setShowAnswer(true);
                    
                    setScore(prev => ({
                        correct: prev.correct + (evaluation.correct ? 1 : 0),
                        total: prev.total + 1
                    }));
                } catch (err) {
                    setError('Failed to evaluate answer. Please try again.');
                    console.error(err);
                } finally {
                    setIsEvaluating(false);
                }
            };

            const resetScore = () => {
                setScore({ correct: 0, total: 0 });
                setFeedback(null);
                setShowAnswer(false);
                setCurrentQuestion(null);
                setUserAnswer('');
            };

            const percentage = score.total > 0 ? Math.round((score.correct / score.total) * 100) : 0;

            return (
                <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-4 md:p-8">
                    <div className="max-w-3xl mx-auto">
                        <div className="bg-white rounded-lg shadow-lg p-6 mb-6">
                            <div className="flex items-center justify-between mb-4">
                                <div className="flex items-center gap-3">
                                    <BookOpen className="w-8 h-8 text-indigo-600" />
                                    <h1 className="text-2xl md:text-3xl font-bold text-gray-800">
                                        Spanish Translation Quiz
                                    </h1>
                                </div>
                            </div>
                            
                            <div className="flex items-center justify-between bg-indigo-50 rounded-lg p-4">
                                <div className="flex items-center gap-4">
                                    <div>
                                        <p className="text-sm text-gray-600">Score</p>
                                        <p className="text-2xl font-bold text-indigo-600">
                                            {score.correct}/{score.total}
                                        </p>
                                    </div>
                                    <div>
                                        <p className="text-sm text-gray-600">Accuracy</p>
                                        <p className="text-2xl font-bold text-indigo-600">{percentage}%</p>
                                    </div>
                                </div>
                                <button
                                    onClick={resetScore}
                                    className="flex items-center gap-2 px-4 py-2 text-sm text-gray-600 hover:text-indigo-600 hover:bg-indigo-100 rounded-lg transition-colors"
                                >
                                    <RefreshCw className="w-4 h-4" />
                                    Reset
                                </button>
                            </div>
                        </div>

                        <div className="bg-white rounded-lg shadow-lg p-6 mb-6">
                            <label className="block text-sm font-medium text-gray-700 mb-2">
                                Select Category
                            </label>
                            <div className="relative">
                                <button
                                    onClick={() => setShowCategoryDropdown(!showCategoryDropdown)}
                                    className="w-full flex items-center justify-between px-4 py-3 bg-white border-2 border-gray-300 rounded-lg hover:border-indigo-400 transition-colors"
                                >
                                    <span className="font-medium text-gray-800">{currentCategory}</span>
                                    <ChevronDown className={`w-5 h-5 text-gray-600 transition-transform ${showCategoryDropdown ? 'rotate-180' : ''}`} />
                                </button>
                                
                                {showCategoryDropdown && (
                                    <div className="absolute z-10 w-full mt-2 bg-white border-2 border-gray-300 rounded-lg shadow-xl max-h-96 overflow-y-auto">
                                        {CATEGORIES.map((cat) => (
                                            <button
                                                key={cat}
                                                onClick={() => {
                                                    setCurrentCategory(cat);
                                                    setShowCategoryDropdown(false);
                                                    setCurrentQuestion(null);
                                                    setFeedback(null);
                                                    setShowAnswer(false);
                                                    setUserAnswer('');
                                                }}
                                                className={`w-full text-left px-4 py-3 hover:bg-indigo-50 transition-colors ${
                                                    cat === currentCategory ? 'bg-indigo-100 font-medium text-indigo-700' : 'text-gray-700'
                                                }`}
                                            >
                                                {cat}
                                            </button>
                                        ))}
                                    </div>
                                )}
                            </div>
                        </div>

                        <div className="bg-white rounded-lg shadow-lg p-6">
                            {!currentQuestion && !isGenerating && (
                                <div className="text-center py-12">
                                    <p className="text-gray-600 mb-6">Ready to practice your Spanish?</p>
                                    <button
                                        onClick={generateQuestion}
                                        className="px-8 py-3 bg-indigo-600 text-white rounded-lg font-medium hover:bg-indigo-700 transition-colors shadow-md"
                                    >
                                        Start Quiz
                                    </button>
                                </div>
                            )}

                            {isGenerating && (
                                <div className="flex flex-col items-center justify-center py-12">
                                    <Loader2 className="w-12 h-12 text-indigo-600 animate-spin mb-4" />
                                    <p className="text-gray-600">Generating question...</p>
                                </div>
                            )}

                            {error && (
                                <div className="bg-red-50 border-2 border-red-200 rounded-lg p-4 mb-6">
                                    <p className="text-red-800">{error}</p>
                                </div>
                            )}

                            {currentQuestion && !showAnswer && (
                                <div>
                                    <div className="mb-6">
                                        <span className="inline-block px-3 py-1 bg-indigo-100 text-indigo-700 rounded-full text-sm font-medium mb-4">
                                            {currentQuestion.category}
                                        </span>
                                        {currentQuestion.difficulty && (
                                            <span className="inline-block px-3 py-1 bg-gray-100 text-gray-700 rounded-full text-sm font-medium mb-4 ml-2">
                                                {currentQuestion.difficulty}
                                            </span>
                                        )}
                                        <h2 className="text-2xl font-bold text-gray-800 mb-2">
                                            Translate to Spanish:
                                        </h2>
                                        <p className="text-xl text-gray-700 mb-2">
                                            "{currentQuestion.englishPrompt}"
                                        </p>
                                        {currentQuestion.context && (
                                            <p className="text-sm text-gray-500 italic">
                                                Context: {currentQuestion.context}
                                            </p>
                                        )}
                                    </div>

                                    <div className="space-y-4">
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-2">
                                                Your Spanish translation:
                                            </label>
                                            <input
                                                type="text"
                                                value={userAnswer}
                                                onChange={(e) => setUserAnswer(e.target.value)}
                                                onKeyPress={(e) => {
                                                    if (e.key === 'Enter' && !isEvaluating && userAnswer.trim()) {
                                                        evaluateAnswer();
                                                    }
                                                }}
                                                disabled={isEvaluating}
                                                className="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-indigo-500 focus:outline-none text-lg disabled:bg-gray-100"
                                                placeholder="Type your answer..."
                                                autoFocus
                                            />
                                        </div>

                                        <button
                                            onClick={evaluateAnswer}
                                            disabled={isEvaluating || !userAnswer.trim()}
                                            className="w-full px-6 py-3 bg-indigo-600 text-white rounded-lg font-medium hover:bg-indigo-700 disabled:bg-gray-300 disabled:cursor-not-allowed transition-colors shadow-md flex items-center justify-center gap-2"
                                        >
                                            {isEvaluating ? (
                                                <>
                                                    <Loader2 className="w-5 h-5 animate-spin" />
                                                    Evaluating...
                                                </>
                                            ) : (
                                                'Submit Answer'
                                            )}
                                        </button>
                                    </div>
                                </div>
                            )}

                            {showAnswer && feedback && (
                                <div>
                                    <div className={`mb-6 p-6 rounded-lg ${
                                        feedback.correct 
                                            ? 'bg-green-50 border-2 border-green-200' 
                                            : 'bg-red-50 border-2 border-red-200'
                                    }`}>
                                        <div className="flex items-center gap-3 mb-4">
                                            {feedback.correct ? (
                                                <Check className="w-8 h-8 text-green-600" />
                                            ) : (
                                                <X className="w-8 h-8 text-red-600" />
                                            )}
                                            <h3 className={`text-2xl font-bold ${
                                                feedback.correct ? 'text-green-800' : 'text-red-800'
                                            }`}>
                                                {feedback.correct ? 'Correct!' : 'Not Quite'}
                                            </h3>
                                        </div>

                                        <p className={`text-lg mb-4 ${
                                            feedback.correct ? 'text-green-800' : 'text-red-800'
                                        }`}>
                                            {feedback.feedback}
                                        </p>

                                        <div className="space-y-3">
                                            <div>
                                                <p className="text-sm font-medium text-gray-600 mb-1">Your answer:</p>
                                                <p className="text-lg text-gray-800">{userAnswer}</p>
                                            </div>

                                            <div>
                                                <p className="text-sm font-medium text-gray-600 mb-1">Correct answer:</p>
                                                <p className="text-lg font-medium text-gray-800">{feedback.correctAnswer}</p>
                                            </div>

                                            {feedback.alternativeAnswers && feedback.alternativeAnswers.length > 0 && (
                                                <div>
                                                    <p className="text-sm font-medium text-gray-600 mb-1">Alternative answers:</p>
                                                    <ul className="list-disc list-inside text-gray-700">
                                                        {feedback.alternativeAnswers.map((alt, idx) => (
                                                            <li key={idx}>{alt}</li>
                                                        ))}
                                                    </ul>
                                                </div>
                                            )}
                                        </div>
                                    </div>

                                    <button
                                        onClick={generateQuestion}
                                        className="w-full px-6 py-3 bg-indigo-600 text-white rounded-lg font-medium hover:bg-indigo-700 transition-colors shadow-md"
                                    >
                                        Next Question
                                    </button>
                                </div>
                            )}
                        </div>
                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<SpanishQuizApp />);
    </script>
</body>
</html>